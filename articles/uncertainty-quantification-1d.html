<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Confidence intervals for KL divergence (1-D) ‚Ä¢ kldest</title>
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.4.2/css/all.min.css" rel="stylesheet">
<link href="../deps/font-awesome-6.4.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Confidence intervals for KL divergence (1-D)">
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">kldest</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">1.0.0.9001</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="active nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles">
<li><a class="dropdown-item" href="../articles/algorithm-benchmark-10d.html">Algorithm benchmark in high dimensions</a></li>
    <li><a class="dropdown-item" href="../articles/algorithm-benchmark-1d.html">Algorithm benchmark in 1D</a></li>
    <li><a class="dropdown-item" href="../articles/algorithm-benchmark-2d.html">Algorithm benchmark in 2D</a></li>
    <li><a class="dropdown-item" href="../articles/comparison-1sample-2sample-1D.html">Comparing 1- vs. 2-sample estimation in 1-D</a></li>
    <li><a class="dropdown-item" href="../articles/uncertainty-quantification-10d.html">Confidence intervals for KL divergence (high-dimensional)</a></li>
    <li><a class="dropdown-item" href="../articles/uncertainty-quantification-1d.html">Confidence intervals for KL divergence (1-D)</a></li>
  </ul>
</li>
<li class="nav-item"><a class="nav-link" href="../news/index.html">Changelog</a></li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json">
</form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/niklhart/kldest/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul>
</div>


  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">

      <h1>Confidence intervals for KL divergence (1-D)</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/niklhart/kldest/blob/master/vignettes/articles/uncertainty-quantification-1d.Rmd" class="external-link"><code>vignettes/articles/uncertainty-quantification-1d.Rmd</code></a></small>
      <div class="d-none name"><code>uncertainty-quantification-1d.Rmd</code></div>
    </div>

    
    
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://niklhart.github.io/kldest/">kldest</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://ggplot2.tidyverse.org" class="external-link">ggplot2</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/hadley/reshape" class="external-link">reshape2</a></span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/Random.html" class="external-link">set.seed</a></span><span class="op">(</span><span class="fl">0</span><span class="op">)</span></span></code></pre></div>
<p>We investigate the following pairs of distributions, for which
analytical KL divergence values are known:</p>
<ul>
<li>
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mtext mathvariant="normal">Exp</mtext><mrow><mo stretchy="true" form="prefix">(</mo><mn>1</mn><mo stretchy="true" form="postfix">)</mo></mrow></mrow><annotation encoding="application/x-tex">\text{Exp}(1)</annotation></semantics></math>
vs.¬†<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mtext mathvariant="normal">Exp</mtext><mrow><mo stretchy="true" form="prefix">(</mo><mn>1</mn><mi>/</mi><mn>12</mn><mo stretchy="true" form="postfix">)</mo></mrow></mrow><annotation encoding="application/x-tex">\text{Exp}(1/12)</annotation></semantics></math>,</li>
<li>
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>ùí©</mi><mrow><mo stretchy="true" form="prefix">(</mo><mn>0</mn><mo>,</mo><mn>1</mn><mo stretchy="true" form="postfix">)</mo></mrow></mrow><annotation encoding="application/x-tex">\mathcal{N}(0,1)</annotation></semantics></math>
vs.¬†<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>ùí©</mi><mrow><mo stretchy="true" form="prefix">(</mo><mn>1</mn><mo>,</mo><msup><mn>2</mn><mn>2</mn></msup><mo stretchy="true" form="postfix">)</mo></mrow></mrow><annotation encoding="application/x-tex">\mathcal{N}(1,2^2)</annotation></semantics></math>,</li>
<li>
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>ùí∞</mi><mrow><mo stretchy="true" form="prefix">(</mo><mn>1</mn><mo>,</mo><mn>2</mn><mo stretchy="true" form="postfix">)</mo></mrow></mrow><annotation encoding="application/x-tex">\mathcal{U}(1,2)</annotation></semantics></math>
vs.¬†<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>ùí∞</mi><mrow><mo stretchy="true" form="prefix">(</mo><mn>0</mn><mo>,</mo><mn>4</mn><mo stretchy="true" form="postfix">)</mo></mrow></mrow><annotation encoding="application/x-tex">\mathcal{U}(0,4)</annotation></semantics></math>.</li>
<li>
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>ùí∞</mi><mrow><mo stretchy="true" form="prefix">(</mo><mn>0</mn><mo>,</mo><mn>1</mn><mo stretchy="true" form="postfix">)</mo></mrow></mrow><annotation encoding="application/x-tex">\mathcal{U}(0,1)</annotation></semantics></math>
vs.¬†<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>ùí©</mi><mrow><mo stretchy="true" form="prefix">(</mo><mn>0</mn><mo>,</mo><mn>1</mn><mo stretchy="true" form="postfix">)</mo></mrow></mrow><annotation encoding="application/x-tex">\mathcal{N}(0,1)</annotation></semantics></math>.</li>
</ul>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">p</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>    exponential <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>lambda1 <span class="op">=</span> <span class="fl">1</span>, lambda2 <span class="op">=</span> <span class="fl">1</span><span class="op">/</span><span class="fl">12</span><span class="op">)</span>,</span>
<span>    gaussian    <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>mu1 <span class="op">=</span> <span class="fl">0</span>, sigma1 <span class="op">=</span> <span class="fl">1</span>, mu2 <span class="op">=</span> <span class="fl">1</span>, sigma2 <span class="op">=</span> <span class="fl">2</span><span class="op">^</span><span class="fl">2</span><span class="op">)</span>,</span>
<span>    uniform     <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>a1 <span class="op">=</span> <span class="fl">1</span>, b1 <span class="op">=</span> <span class="fl">2</span>, a2 <span class="op">=</span> <span class="fl">0</span>, b2 <span class="op">=</span> <span class="fl">4</span><span class="op">)</span>,</span>
<span>    unif_gauss  <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>a <span class="op">=</span> <span class="fl">0</span>, b <span class="op">=</span> <span class="fl">1</span>, mu <span class="op">=</span> <span class="fl">0</span>, sigma2 <span class="op">=</span> <span class="fl">1</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span><span class="va">distributions</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>    exponential <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>        samples <span class="op">=</span> <span class="kw">function</span><span class="op">(</span><span class="va">n</span>, <span class="va">m</span><span class="op">)</span> <span class="op">{</span></span>
<span>            <span class="va">X</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/Exponential.html" class="external-link">rexp</a></span><span class="op">(</span><span class="va">n</span>, rate <span class="op">=</span> <span class="va">p</span><span class="op">$</span><span class="va">exponential</span><span class="op">$</span><span class="va">lambda1</span><span class="op">)</span></span>
<span>            <span class="va">Y</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/Exponential.html" class="external-link">rexp</a></span><span class="op">(</span><span class="va">m</span>, rate <span class="op">=</span> <span class="va">p</span><span class="op">$</span><span class="va">exponential</span><span class="op">$</span><span class="va">lambda2</span><span class="op">)</span></span>
<span>            <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>X <span class="op">=</span> <span class="va">X</span>, Y <span class="op">=</span> <span class="va">Y</span><span class="op">)</span></span>
<span>        <span class="op">}</span>,</span>
<span>        kld <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/do.call.html" class="external-link">do.call</a></span><span class="op">(</span><span class="va">kld_exponential</span>, <span class="va">p</span><span class="op">$</span><span class="va">exponential</span><span class="op">)</span></span>
<span>    <span class="op">)</span>,</span>
<span>    gaussian <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>        samples <span class="op">=</span> <span class="kw">function</span><span class="op">(</span><span class="va">n</span>, <span class="va">m</span><span class="op">)</span> <span class="op">{</span></span>
<span>            <span class="va">X</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">rnorm</a></span><span class="op">(</span><span class="va">n</span>, mean <span class="op">=</span> <span class="va">p</span><span class="op">$</span><span class="va">gaussian</span><span class="op">$</span><span class="va">mu1</span>, sd <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/MathFun.html" class="external-link">sqrt</a></span><span class="op">(</span><span class="va">p</span><span class="op">$</span><span class="va">gaussian</span><span class="op">$</span><span class="va">sigma1</span><span class="op">)</span><span class="op">)</span></span>
<span>            <span class="va">Y</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">rnorm</a></span><span class="op">(</span><span class="va">m</span>, mean <span class="op">=</span> <span class="va">p</span><span class="op">$</span><span class="va">gaussian</span><span class="op">$</span><span class="va">mu2</span>, sd <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/MathFun.html" class="external-link">sqrt</a></span><span class="op">(</span><span class="va">p</span><span class="op">$</span><span class="va">gaussian</span><span class="op">$</span><span class="va">sigma2</span><span class="op">)</span><span class="op">)</span></span>
<span>            <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>X <span class="op">=</span> <span class="va">X</span>, Y <span class="op">=</span> <span class="va">Y</span><span class="op">)</span></span>
<span>        <span class="op">}</span>,</span>
<span>        kld <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/do.call.html" class="external-link">do.call</a></span><span class="op">(</span><span class="va">kld_gaussian</span>, <span class="va">p</span><span class="op">$</span><span class="va">gaussian</span><span class="op">)</span></span>
<span>    <span class="op">)</span>,</span>
<span>    uniform <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span> </span>
<span>        samples <span class="op">=</span> <span class="kw">function</span><span class="op">(</span><span class="va">n</span>, <span class="va">m</span><span class="op">)</span> <span class="op">{</span></span>
<span>            <span class="va">X</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/Uniform.html" class="external-link">runif</a></span><span class="op">(</span><span class="va">n</span>, min <span class="op">=</span> <span class="va">p</span><span class="op">$</span><span class="va">uniform</span><span class="op">$</span><span class="va">a1</span>, max <span class="op">=</span> <span class="va">p</span><span class="op">$</span><span class="va">uniform</span><span class="op">$</span><span class="va">b1</span><span class="op">)</span></span>
<span>            <span class="va">Y</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/Uniform.html" class="external-link">runif</a></span><span class="op">(</span><span class="va">m</span>, min <span class="op">=</span> <span class="va">p</span><span class="op">$</span><span class="va">uniform</span><span class="op">$</span><span class="va">a2</span>, max <span class="op">=</span> <span class="va">p</span><span class="op">$</span><span class="va">uniform</span><span class="op">$</span><span class="va">b2</span><span class="op">)</span></span>
<span>            <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>X <span class="op">=</span> <span class="va">X</span>, Y <span class="op">=</span> <span class="va">Y</span><span class="op">)</span></span>
<span>        <span class="op">}</span>,</span>
<span>        kld <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/do.call.html" class="external-link">do.call</a></span><span class="op">(</span><span class="va">kld_uniform</span>, <span class="va">p</span><span class="op">$</span><span class="va">uniform</span><span class="op">)</span></span>
<span>    <span class="op">)</span>,</span>
<span>    unif_gauss <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>        samples <span class="op">=</span> <span class="kw">function</span><span class="op">(</span><span class="va">n</span>, <span class="va">m</span><span class="op">)</span> <span class="op">{</span></span>
<span>            <span class="va">X</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/Uniform.html" class="external-link">runif</a></span><span class="op">(</span><span class="va">n</span>, min <span class="op">=</span> <span class="va">p</span><span class="op">$</span><span class="va">unif_gauss</span><span class="op">$</span><span class="va">a</span>, max <span class="op">=</span> <span class="va">p</span><span class="op">$</span><span class="va">unif_gauss</span><span class="op">$</span><span class="va">b</span><span class="op">)</span></span>
<span>            <span class="va">Y</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">rnorm</a></span><span class="op">(</span><span class="va">m</span>, mean <span class="op">=</span> <span class="va">p</span><span class="op">$</span><span class="va">unif_gauss</span><span class="op">$</span><span class="va">mu</span>, sd <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/MathFun.html" class="external-link">sqrt</a></span><span class="op">(</span><span class="va">p</span><span class="op">$</span><span class="va">unif_gauss</span><span class="op">$</span><span class="va">sigma2</span><span class="op">)</span><span class="op">)</span></span>
<span>            <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>X <span class="op">=</span> <span class="va">X</span>, Y <span class="op">=</span> <span class="va">Y</span><span class="op">)</span></span>
<span>        <span class="op">}</span>,</span>
<span>        kld <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/do.call.html" class="external-link">do.call</a></span><span class="op">(</span><span class="va">kld_uniform_gaussian</span>, <span class="va">p</span><span class="op">$</span><span class="va">unif_gauss</span><span class="op">)</span></span>
<span>    <span class="op">)</span></span>
<span><span class="op">)</span></span></code></pre></div>
<p>Analytical values for Kullback-Leibler divergences in test cases:</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">vapply</a></span><span class="op">(</span><span class="va">distributions</span>, <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="va">x</span><span class="op">$</span><span class="va">kld</span>, <span class="fl">1</span><span class="op">)</span></span>
<span><span class="co">#&gt; exponential    gaussian     uniform  unif_gauss </span></span>
<span><span class="co">#&gt;   1.5682400   0.4431472   1.3862944   1.0856052</span></span></code></pre></div>
<div class="section level3">
<h3 id="simulation-scenarios">Simulation scenarios<a class="anchor" aria-label="anchor" href="#simulation-scenarios"></a>
</h3>
<p>For each of the distributions specified above, samples of different
sizes are drawn, with several replicates per distribution and sample
size.</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">samplesize</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">100</span>,<span class="fl">1000</span>,<span class="fl">10000</span><span class="op">)</span></span>
<span><span class="va">nRep</span>       <span class="op">&lt;-</span> <span class="fl">500L</span></span>
<span></span>
<span><span class="va">scenarios</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/combinations.html">combinations</a></span><span class="op">(</span></span>
<span>    distribution <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">distributions</span><span class="op">)</span>,</span>
<span>    sample.size  <span class="op">=</span> <span class="va">samplesize</span>,</span>
<span>    replicate    <span class="op">=</span> <span class="fl">1</span><span class="op">:</span><span class="va">nRep</span></span>
<span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="algorithm-subsampling-methods">Algorithm &amp; subsampling methods<a class="anchor" aria-label="anchor" href="#algorithm-subsampling-methods"></a>
</h3>
<p>The plain 1-NN estimator is considered for this example (according to
the 1-D estimation benchmark, there is no expected benefit but
additional cost for the bias-reduced version).</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">estimator</span> <span class="op">&lt;-</span> <span class="va">kld_est_nn</span></span></code></pre></div>
<p>We use the following subsampling methods:</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">subsmethod</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>    sub_n12_q <span class="op">=</span> <span class="kw">function</span><span class="op">(</span><span class="va">...</span><span class="op">)</span> <span class="fu"><a href="../reference/kld_ci_subsampling.html">kld_ci_subsampling</a></span><span class="op">(</span><span class="va">...</span>, </span>
<span>                                                 subsample.size <span class="op">=</span> <span class="kw">function</span><span class="op">(</span><span class="va">n</span><span class="op">)</span> <span class="va">n</span><span class="op">^</span><span class="op">(</span><span class="fl">1</span><span class="op">/</span><span class="fl">2</span><span class="op">)</span>,</span>
<span>                                                 method <span class="op">=</span> <span class="st">"quantile"</span><span class="op">)</span>, </span>
<span>    sub_n23_q <span class="op">=</span> <span class="kw">function</span><span class="op">(</span><span class="va">...</span><span class="op">)</span> <span class="fu"><a href="../reference/kld_ci_subsampling.html">kld_ci_subsampling</a></span><span class="op">(</span><span class="va">...</span>, </span>
<span>                                                 subsample.size <span class="op">=</span> <span class="kw">function</span><span class="op">(</span><span class="va">n</span><span class="op">)</span> <span class="va">n</span><span class="op">^</span><span class="op">(</span><span class="fl">2</span><span class="op">/</span><span class="fl">3</span><span class="op">)</span>,</span>
<span>                                                 method <span class="op">=</span> <span class="st">"quantile"</span><span class="op">)</span>, </span>
<span>    sub_n12_se <span class="op">=</span> <span class="kw">function</span><span class="op">(</span><span class="va">...</span><span class="op">)</span> <span class="fu"><a href="../reference/kld_ci_subsampling.html">kld_ci_subsampling</a></span><span class="op">(</span><span class="va">...</span>, </span>
<span>                                                  subsample.size <span class="op">=</span> <span class="kw">function</span><span class="op">(</span><span class="va">n</span><span class="op">)</span> <span class="va">n</span><span class="op">^</span><span class="op">(</span><span class="fl">1</span><span class="op">/</span><span class="fl">2</span><span class="op">)</span>,</span>
<span>                                                  method <span class="op">=</span> <span class="st">"se"</span><span class="op">)</span>,</span>
<span>    sub_n23_se <span class="op">=</span> <span class="kw">function</span><span class="op">(</span><span class="va">...</span><span class="op">)</span> <span class="fu"><a href="../reference/kld_ci_subsampling.html">kld_ci_subsampling</a></span><span class="op">(</span><span class="va">...</span>, </span>
<span>                                                  subsample.size <span class="op">=</span> <span class="kw">function</span><span class="op">(</span><span class="va">n</span><span class="op">)</span> <span class="va">n</span><span class="op">^</span><span class="op">(</span><span class="fl">2</span><span class="op">/</span><span class="fl">3</span><span class="op">)</span>, </span>
<span>                                                  method <span class="op">=</span> <span class="st">"se"</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span><span class="va">subsamplingMethodLabels</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span></span>
<span>    sub_n12_q <span class="op">=</span> <span class="st">"Quantile, s = n^(1/2)"</span>,</span>
<span>    sub_n23_q <span class="op">=</span> <span class="st">"Quantile, s = n^(2/3)"</span>,</span>
<span>    sub_n12_se <span class="op">=</span> <span class="st">"Std. err., s = n^(1/2)"</span>,</span>
<span>    sub_n23_se <span class="op">=</span> <span class="st">"Std. err., s = n^(2/3)"</span></span>
<span><span class="op">)</span></span>
<span><span class="va">nmethod</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">subsmethod</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="uncertainty-quantification-of-estimators">Uncertainty quantification of estimators<a class="anchor" aria-label="anchor" href="#uncertainty-quantification-of-estimators"></a>
</h2>
<div class="section level3">
<h3 id="calculation-of-empirical-coverage">Calculation of empirical coverage<a class="anchor" aria-label="anchor" href="#calculation-of-empirical-coverage"></a>
</h3>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># allocating results matrices</span></span>
<span><span class="va">nscenario</span>  <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">scenarios</span><span class="op">)</span></span>
<span><span class="va">covered</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">matrix</a></span><span class="op">(</span>nrow <span class="op">=</span> <span class="va">nscenario</span>, </span>
<span>                  ncol <span class="op">=</span> <span class="va">nmethod</span>, </span>
<span>                  dimnames <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="cn">NULL</span>, <span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">subsmethod</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># looping over scenarios</span></span>
<span><span class="kw">for</span> <span class="op">(</span><span class="va">i</span> <span class="kw">in</span> <span class="fl">1</span><span class="op">:</span><span class="va">nscenario</span><span class="op">)</span> <span class="op">{</span></span>
<span></span>
<span>    <span class="va">dist</span> <span class="op">&lt;-</span> <span class="va">scenarios</span><span class="op">$</span><span class="va">distribution</span><span class="op">[</span><span class="va">i</span><span class="op">]</span></span>
<span>    <span class="va">n</span>    <span class="op">&lt;-</span> <span class="va">scenarios</span><span class="op">$</span><span class="va">sample.size</span><span class="op">[</span><span class="va">i</span><span class="op">]</span></span>
<span>    </span>
<span>    <span class="va">samples</span> <span class="op">&lt;-</span> <span class="va">distributions</span><span class="op">[[</span><span class="va">dist</span><span class="op">]</span><span class="op">]</span><span class="op">$</span><span class="fu">sample</span><span class="op">(</span>n <span class="op">=</span> <span class="va">n</span>, m <span class="op">=</span> <span class="va">n</span><span class="op">)</span></span>
<span>    <span class="va">kld</span>     <span class="op">&lt;-</span> <span class="va">distributions</span><span class="op">[[</span><span class="va">dist</span><span class="op">]</span><span class="op">]</span><span class="op">$</span><span class="va">kld</span></span>
<span>    </span>
<span>    <span class="va">X</span> <span class="op">&lt;-</span> <span class="va">samples</span><span class="op">$</span><span class="va">X</span></span>
<span>    <span class="va">Y</span> <span class="op">&lt;-</span> <span class="va">samples</span><span class="op">$</span><span class="va">Y</span></span>
<span>    </span>
<span>    <span class="co"># all subsampling methods are evaluated on the same samples</span></span>
<span>    <span class="kw">for</span> <span class="op">(</span><span class="va">j</span> <span class="kw">in</span> <span class="fl">1</span><span class="op">:</span><span class="va">nmethod</span><span class="op">)</span> <span class="op">{</span></span>
<span>        <span class="va">kldboot</span> <span class="op">&lt;-</span> <span class="va">subsmethod</span><span class="op">[[</span><span class="va">j</span><span class="op">]</span><span class="op">]</span><span class="op">(</span><span class="va">X</span>, <span class="va">Y</span>, estimator <span class="op">=</span> <span class="va">estimator</span>, B <span class="op">=</span> <span class="fl">500L</span><span class="op">)</span></span>
<span>        <span class="va">covered</span><span class="op">[</span><span class="va">i</span>,<span class="va">j</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="va">kldboot</span><span class="op">$</span><span class="va">ci</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span> <span class="op">&lt;=</span> <span class="va">kld</span> <span class="op">&amp;&amp;</span> <span class="va">kld</span> <span class="op">&lt;=</span> <span class="va">kldboot</span><span class="op">$</span><span class="va">ci</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span></span>
<span>    <span class="op">}</span></span>
<span><span class="op">}</span></span></code></pre></div>
<p>Combine scenarios with CI coverage information:</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">results</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">cbind</a></span><span class="op">(</span><span class="va">scenarios</span>, <span class="va">covered</span><span class="op">)</span> <span class="op">|&gt;</span> <span class="fu"><a href="https://rdrr.io/pkg/reshape2/man/melt.html" class="external-link">melt</a></span><span class="op">(</span>measure.vars  <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">subsmethod</span><span class="op">)</span>,</span>
<span>                                             value.name    <span class="op">=</span> <span class="st">"covered"</span>,</span>
<span>                                             variable.name <span class="op">=</span> <span class="st">"subsmethod"</span><span class="op">)</span> </span></code></pre></div>
<p>Compute coverage per sample size / subsampling method /
distribution:</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">coverage</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/reshape2/man/cast.html" class="external-link">dcast</a></span><span class="op">(</span><span class="va">results</span>, </span>
<span>                  <span class="va">sample.size</span> <span class="op">+</span> <span class="va">subsmethod</span> <span class="op">+</span> <span class="va">distribution</span> <span class="op">~</span> <span class="va">.</span>, </span>
<span>                  value.var <span class="op">=</span> <span class="st">"covered"</span>, </span>
<span>                  fun.aggregate <span class="op">=</span> <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span><span class="va">x</span>, na.rm <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">coverage</span><span class="op">)</span><span class="op">[</span><span class="fl">4</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="st">"coverage"</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="results-coverage-of-confidence-intervals-for-kl-divergence">Results: coverage of confidence intervals for KL divergence<a class="anchor" aria-label="anchor" href="#results-coverage-of-confidence-intervals-for-kl-divergence"></a>
</h3>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="va">coverage</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">sample.size</span>, y <span class="op">=</span> <span class="va">coverage</span>, color <span class="op">=</span> <span class="va">subsmethod</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> </span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/facet_wrap.html" class="external-link">facet_wrap</a></span><span class="op">(</span><span class="st">"distribution"</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html" class="external-link">geom_line</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span> </span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_continuous.html" class="external-link">scale_x_log10</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_abline.html" class="external-link">geom_hline</a></span><span class="op">(</span>yintercept <span class="op">=</span> <span class="fl">0.95</span>, lty <span class="op">=</span> <span class="fl">2</span><span class="op">)</span> <span class="op">+</span> </span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_colour_discrete.html" class="external-link">scale_color_discrete</a></span><span class="op">(</span>name <span class="op">=</span> <span class="st">"CI calculation method"</span>,</span>
<span>                        labels <span class="op">=</span> <span class="va">subsamplingMethodLabels</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">ggtitle</a></span><span class="op">(</span><span class="st">"Converage of subsampling-based confidence intervals (1-D)"</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html" class="external-link">theme</a></span><span class="op">(</span>plot.title <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_text</a></span><span class="op">(</span>hjust <span class="op">=</span> <span class="fl">0.5</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p><img src="uncertainty-quantification-1d_files/figure-html/unnamed-chunk-10-1.png" width="700"></p>
<p><math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mo>‚áí</mo><annotation encoding="application/x-tex">\Rightarrow</annotation></semantics></math>
coverage of the confidence intervals based on nearest neighbour density
estimation approaches the nominal coverage of 95% for increasing sample
sizes. Coverage is quite robust to the choice of subsample size ‚Äì which
is an argument for using the larger one,
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>s</mi><mo>=</mo><msup><mi>n</mi><mrow><mo stretchy="true" form="prefix">(</mo><mn>2</mn><mi>/</mi><mn>3</mn><mo stretchy="true" form="postfix">)</mo></mrow></msup></mrow><annotation encoding="application/x-tex">s = n^{(2/3)}</annotation></semantics></math>,
since it leads to smaller confidence intervals. Using a
subsampling-based estimate of the KL divergence estimator‚Äôs standard
error in a normal approximation seems to improve coverage compared to
the standard quantile method.</p>
</div>
<div class="section level3">
<h3 id="further-notes">Further notes<a class="anchor" aria-label="anchor" href="#further-notes"></a>
</h3>
<p>The above investigated confidence interval calculation method, namely
subsampling for a nearest neighbour-based KL divergence estimator,
performs best and is recommended. However, other estimators and
confidence interval calculation methods are available in the
<code>kldest</code> package. Some comments on their performance can be
found here.</p>
<div class="section level4">
<h4 id="confidence-intervals-for-the-kernel-density-based-method">Confidence intervals for the kernel density-based method<a class="anchor" aria-label="anchor" href="#confidence-intervals-for-the-kernel-density-based-method"></a>
</h4>
<p>When the kernel density based KL divergence method performs well in
the estimation benchmark (such as for Gaussians), confidence intervals
also show good coverage properties. However, in cases where the KL
divergence estimate shows considerable bias in the estimation benchmark
(exponential or uniform distributions), uncertainty quantification also
fails. Tailoring the kernel properties (kernel class, bandwidth) to the
distribution of interest might allow for improved performance in such
cases.</p>
</div>
<div class="section level4">
<h4 id="confidence-intervals-based-on-bootstrapping-with-replacement">Confidence intervals based on bootstrapping with replacement<a class="anchor" aria-label="anchor" href="#confidence-intervals-based-on-bootstrapping-with-replacement"></a>
</h4>
<p>Whether to use bootstrapping or subsampling for uncertainty
quantification does not play a role for kernel density-based methods ‚Äì
coverage is similar. However, results are dramatically different for
nearest neighbour density-based methods, which cannot deal with the ties
produced by resampling with replacement.</p>
</div>
</div>
</div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p>Developed by Niklas Hartung.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.1.</p>
</div>

    </footer>
</div>





  </body>
</html>
